---
- name: Ensure /arsenal/sources directory exists
  file:
    path: "/arsenal/sources"
    state: directory
    mode: "0755"

- name: Install exploitDB
  git:
    repo: "https://gitlab.com/exploit-database/exploitdb.git"
    dest: "/arsenal/sources/exploitdb"
    clone: yes
    update: yes
    version: 2024-11-26
    force: yes

- name: Ensure /arsenal/bin directory exists
  file:
    path: "/arsenal/bin"
    state: directory
    mode: "0755"

- name: Create symlink for searchsploit
  file:
    src: "/arsenal/sources/exploitdb/searchsploit"
    dest: "/arsenal/bin/searchsploit"
    state: link
    force: yes

- name: Update ExploitDB indexes
  command: /arsenal/bin/searchsploit -u
  changed_when: false

- name: Verify searchsploit Installation
  command: searchsploit windows smb
  register: searchsploit_test
  changed_when: false

- name: Debug searchsploit Installation Status
  debug:
    msg: "{{ 'searchsploit installed successfully!' if searchsploit_test.rc == 0 else 'searchsploit installation failed!' }}"
